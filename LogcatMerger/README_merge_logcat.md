# logcat日志合并脚本使用说明

## 脚本功能
`merge_logcat.sh` 是一个bash脚本，用于合并logcat轮转日志文件。它会：
1. 遍历指定文件夹中的所有logcat日志文件（包括 `logcat` 和 `logcat.XX` 格式）
2. 按照文件的修改时间顺序排序（从早到晚）
3. 将所有日志文件合并成一个完整的文件 `logcat_all.log`
4. 输出详细的运行日志，包括处理的文件列表、行数统计等

## 系统要求
- Git Bash (Windows)
- 或 Linux/macOS 系统
- bash 4.0+

## 使用方法

### 1. 赋予脚本执行权限（首次使用）
在Git Bash中执行：
```bash
chmod +x merge_logcat.sh
```

### 2. 运行脚本
```bash
./merge_logcat.sh <文件夹路径>
```

### 示例
```bash
# 合并当前目录下的logcat文件
./merge_logcat.sh .

# 合并指定路径下的logcat文件
./merge_logcat.sh "D:\工作资料\电信云\2026年2月6日\0209加班\log_2026-02-09_21-50-50\data\misc\logd"
```

## 输出说明

### 输出文件
- 文件名：`logcat_all.log`
- 位置：与输入的文件夹路径相同
- 如果输出文件已存在，会自动备份为 `logcat_all.log.backup.YYYYMMDD_HHMMSS`

### 运行日志
脚本会输出以下信息：
- `[INFO]` - 一般信息（蓝色）
- `[SUCCESS]` - 成功信息（绿色）
- `[WARNING]` - 警告信息（黄色）
- `[ERROR]` - 错误信息（红色）

日志内容包括：
- 找到的文件列表及时间信息
- 文件排序结果
- 每个文件的处理进度和行数
- 最终统计信息（总行数、文件大小等）

## 排序逻辑

脚本使用以下方法确定文件顺序：
1. **优先方法**：使用文件的修改时间（`stat` 命令）
   - 兼容Linux (`stat -c %Y`)
   - 兼容macOS/BSD (`stat -f %m`)
   - 兼容Git Bash (`stat --format=%Y`)

2. **备选方法**：如果无法获取修改时间，使用文件名中的数字部分
   - `logcat.01` → 排序键: 000001
   - `logcat.25` → 排序键: 000025
   - `logcat` → 排序键: 999999（假设是最新的）

## 注意事项

1. **文件路径**：Windows路径可以使用正斜杠 `/` 或反斜杠 `\`，但建议使用引号包裹包含空格的路径
2. **文件权限**：确保脚本有读取源文件和写入目标文件的权限
3. **磁盘空间**：确保有足够的磁盘空间存储合并后的文件
4. **文件格式**：脚本会处理所有以 `logcat` 开头的文件，请确保文件夹中没有其他不需要合并的文件

## 故障排除

### 问题：提示"未找到任何logcat日志文件"
- 检查文件夹路径是否正确
- 确认文件夹中确实存在 `logcat` 或 `logcat.XX` 格式的文件

### 问题：提示"无法切换到文件夹"
- 检查文件夹路径是否存在
- 检查是否有访问权限

### 问题：合并后的文件顺序不正确
- 脚本优先使用文件修改时间排序
- 如果文件修改时间不准确，可能会影响排序结果
- 可以手动检查文件内容中的时间戳来验证

## 示例输出

```
[INFO] 2026-02-09 22:00:00 - 开始处理文件夹: /path/to/logd
[INFO] 2026-02-09 22:00:00 - 正在查找logcat日志文件...
[INFO] 2026-02-09 22:00:00 - 找到文件: logcat.01 (时间戳: 2026-02-09 21:50:20)
[INFO] 2026-02-09 22:00:00 - 找到文件: logcat.02 (时间戳: 2026-02-09 21:50:21)
...
[INFO] 2026-02-09 22:00:00 - 共找到 26 个logcat日志文件
[INFO] 2026-02-09 22:00:00 - 正在按时间顺序排序文件...
[INFO] 2026-02-09 22:00:00 - 开始合并日志文件到: logcat_all.log
[SUCCESS] 2026-02-09 22:00:01 - 合并完成！
[INFO] 2026-02-09 22:00:01 - 输出文件: /path/to/logd/logcat_all.log
[INFO] 2026-02-09 22:00:01 - 文件大小: 50MB
[INFO] 2026-02-09 22:00:01 - 总行数: 500000
```
